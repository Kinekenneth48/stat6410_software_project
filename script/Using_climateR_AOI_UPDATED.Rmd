---
title: "Using the climateR and AOI package"
author: "Kenneth Pomeyie, Scout Jarman, Paul Gaona-Partida"
output:
  pdf_document: default
---

### Introduction
A climatic data element is a measured parameter that helps to specify the climate information of a specific location or region, such as precipitation, temperature, wind speed, and humidity. Raster data models(files) are one way of storing climate data in pixels. The size of these raster files tends to get large as dimensionality increases with time, multiple variables, and multiple models. In most cases, only a small amount of information is needed from these files. The hard way to extract site-specific climate information from raster files involves downloading the files and extracting the required information individually to reduce size. However, this data extraction method is inefficient and memory-limited because R loads everything in RAM. This vignette shows how the climateR and AOI packages can be used to call specific climate data more efficiently.

#### Introduction to AOI and climateR package
Scout


### Advantages of  AOI and climateR package
Paul

### AOI Usage
 Paul and Scout start
### 1. Load libraries
```{r }
# INSTALL
#remotes::install_github("mikejohnson51/AOI")
#remotes::install_github("mikejohnson51/climateR")

#load library
library(sf)
library(climateR)
library(AOI)
library(ggplot2)
library(leaflet.extras)
```

<br>


### 2. Geocode locations 
```{r}
# get point geometry of Logan
logan <- geocode(
  location = "Logan",
  zipcode = NULL, event = NULL, pt = TRUE, bb = FALSE
)
```


```{r}
# check if the location is right
aoi_map(AOI = logan, returnMap = TRUE)
```


```{r}
# use correct location name
logan <- geocode(location = "Logan UT", pt = TRUE)
```


```{r}
# check if the location is right
aoi_map(AOI = logan, returnMap = TRUE)
```


```{r}
# Interactively draw an Area of Interest
aoi_draw()

test <- sf::st_read("aoi_draw/test.gpkg")

aoi_map(test, returnMap = TRUE)

```


<br>

### 3. Queries for state and county boundaries
```{r}
# get Cache county boundaries
cache_aoi <- aoi_get(state = "UT", county = "Cache")
cache_aoi
```


```{r}
# map area of interest
aoi_map(AOI = cache_aoi, returnMap = TRUE)
```

```{r}
# get Utah state boundaries
ut_aoi <- aoi_get(state = "UT", county = "all")
```


```{r}
# map area of interest
aoi_map(AOI = ut_aoi, returnMap = TRUE)
```

<br>

Paul and Scout end

### climateR Usage
### 4. Point Based Time Series 
In this example, we will show how to download a point based time series with a single climate data for a specified location. For this example, we want to get the minimum temperature of Logan, UT from the PRISM climate source. PRISM is a dataset of daily high-spatial resolution (4-km) surface meteorological data covering the contiguous US from 1981-present. Using the getPRISM function, we specify our area of interest(Logan, UT), the start and end time, and the minimum temperature as the parameter. 
```{r}
# get minimum temperature from PRSIM
logan_temp <- climateR::getPRISM(
  AOI = AOI::geocode(location = "Logan UT", pt = TRUE),
  param = "tmin", startDate = "2021-01-01",
  endDate = "2021-12-31"
)
head(logan_temp)
```




<br>

### 5. Multi Point Time Series 
In this section of the workflow, we will show how to download multi point times series of climate data. 
For this example, we will download precipitation and minim temperature for Logan, Salt Lake, and Brigham in Utah from the GridMET climate source. GridMET is a dataset of daily high-spatial resolution (4-km) surface meteorological data covering the contiguous US from 1979-yesterday. First, we will use the **geocode** function to create an sf object of point geometry for the specified locations. Next, we will feed the **getGridMET** with our defined sf object and specify our climate type along with the date range. The **getGridMET** will return a list of two raster files representing precipitation and minimum temperature. Finally, we use the **extract_sites** to extract the climate data for the locations, which returns a list.
```{r}
# get point of 3 sites
sites <- AOI::geocode(location = c(
  "Logan UT", "Salt Lake UT", "Brigham UT"
), pt = TRUE)


# get precipitation and min temp from GridMET
ut_ppt_tmin <- getGridMET(
  AOI = sites,
  param = c("prcp", "tmin"), startDate = "2021-01-01",
  endDate = "2021-01-31"
)


# extract precipitation and temperature for specified sites from the raster stack
site_extract <- extract_sites(ut_ppt_tmin, sites, "request")

head(site_extract$gridmet_prcp, n=5)
head(site_extract$gridmet_tmin, n=5)
```


<br>

### 6. Multi-layer raster 
In this section of the workflow, we show how to download a multi-layer raster file from the GridMET climate source. Using **getGridMET** function we will define the area of interest, the climate parameter and the date range. The difference example 4 and this example is the type of sf object fed to the **getGridMET**. In this example since we want a raster file we defined the our of interest as a polygon. Below is the plot of the rasters of minimum and maximum temperature for the state of Utah for January 1, 2000. 
```{r eval=FALSE, include=FALSE}
# get max and min temp  rasters from GridMET
grids <- getGridMET(aoi_get(state = "UT"),
  param = c("tmax", "tmin"),
  startDate = "2000-01-01"
)
plot(raster::stack(grids), main = c("Min Temperature", "Max Temperture"))
```



